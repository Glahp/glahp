<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>AuraAI ‚Ä¢ Play ‚Ä¢ Create</title>
<link rel="icon" href="data:,">
<style>
  :root{
    --bg: #0e1116;
    --glass: rgba(255,255,255,0.12);
    --glass-2: rgba(255,255,255,0.08);
    --stroke: rgba(255,255,255,0.18);
    --text: #eef2f6;
    --muted: #b8c0cc;
    --accent: #7cc6ff;
    --accent-2: #a8a6ff;
    --good: #59e48f;
    --bad: #ff7373;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, "Helvetica Neue", Arial;
    color:var(--text);
    background: radial-gradient(1200px 1200px at 10% -10%, #31405644, transparent 60%),
                radial-gradient(1000px 1000px at 90% -20%, #6245ff33, transparent 60%),
                linear-gradient(180deg, #0b0f14, #0e1116);
    backdrop-filter: blur(0.5px);
  }
  .shell{
    max-width:1200px; margin:32px auto; padding:24px;
    border-radius:28px; background: var(--glass);
    border:1px solid var(--stroke); box-shadow: 0 30px 80px #0007, inset 0 1px 0 #fff1;
    backdrop-filter: blur(16px) saturate(120%);
    position:relative;
    min-height:640px;
  }
  .clock{padding:8px 12px;border-radius:14px;background:var(--glass-2);border:1px solid var(--stroke);font-variant-numeric:tabular-nums;letter-spacing:.5px;box-shadow:inset 0 1px 0 #fff2;margin:0 auto}
  .tabs{display:flex; gap:10px; margin-bottom:18px; flex-wrap:wrap; align-items:center}
  .tab{
    padding:10px 14px; border-radius:16px;
    background:linear-gradient(180deg, #ffffff14, #ffffff08);
    border:1px solid var(--stroke); cursor:pointer; transition: .15s ease transform, .15s ease filter;
    box-shadow: 0 8px 16px #0005, inset 0 1px 0 #fff1;
  }
  .tab:hover{transform:translateY(-1px)}
  .tab.active{background:linear-gradient(180deg, #7cc6ff33, #a8a6ff26); border-color:#7cc6ff66}
  .bar{
    display:flex; align-items:center; gap:10px; margin:10px 0 18px;
    flex-wrap:wrap;
  }
  .chip{padding:6px 10px; border-radius:12px; background:var(--glass-2); border:1px solid var(--stroke); cursor:pointer}
  .chip[aria-pressed="true"]{outline:2px solid var(--accent); background:#7cc6ff1f}
  .dock{
    display:flex; gap:12px; flex-wrap:wrap; align-items:center
  }
  .dock .chip{display:flex; align-items:center; gap:8px}
  .dock .chip .dot{width:10px; height:10px; border-radius:50%; background:var(--accent-2)}
  .btn{
    padding:10px 14px; border-radius:16px; border:1px solid var(--stroke);
    background:linear-gradient(180deg, #ffffff14, #ffffff08); cursor:pointer;
    box-shadow: 0 8px 16px #0005, inset 0 1px 0 #fff1; transition:.2s ease transform, .2s ease filter;
  }
  .btn:hover{transform:translateY(-1px)}
  .panel{display:none}
  .panel.active{display:block}
  .row{display:flex; gap:18px; flex-wrap:wrap}
  .left{flex:1 1 380px}
  .right{flex:1 1 380px}
  .card{
    border-radius:18px; padding:14px; background:linear-gradient(180deg, #ffffff14, #ffffff08);
    border:1px solid var(--stroke); box-shadow: 0 8px 24px #0005, inset 0 1px 0 #fff1;
  }
  .input{
    width:100%; padding:12px 14px; border-radius:14px; border:1px solid var(--stroke);
    background:rgba(255,255,255,0.06); color:var(--text);
  }
  .quick{display:flex; gap:8px; flex-wrap:wrap}
  .bubble{padding:8px 12px; border-radius:14px; border:1px solid var(--stroke); background:rgba(255,255,255,0.06); cursor:pointer}
  .bubble[aria-pressed="true"]{outline:2px solid #ffffff55}
  .chat{
    height:480px; overflow:auto; padding:14px; display:flex; flex-direction:column; gap:8px;
    scroll-behavior:smooth;
  }
  .msg{
    max-width:80%; padding:10px 14px; border-radius:18px; position:relative;
    background:linear-gradient(180deg, #ffffff14, #ffffff0a); border:1px solid var(--stroke);
    box-shadow: 0 8px 24px #0005, inset 0 1px 0 #fff2; animation: fadeIn .25s ease;
  }
  @keyframes fadeIn{from{opacity:0; transform:translateY(4px)} to{opacity:1; transform:none}}
  .msg.me{margin-left:auto; background:linear-gradient(180deg, #7cc6ff33, #a8a6ff26)}
  .msg a{color:var(--accent)}
  .drawwrap{display:grid; grid-template-columns:1fr 280px; gap:12px}
  .tools{display:flex; gap:8px; flex-wrap:wrap}
  .tool{padding:6px 10px; border-radius:12px; border:1px solid var(--stroke); background:rgba(255,255,255,0.06); cursor:pointer}
  .tool[aria-pressed="true"]{outline:2px solid var(--accent)}
  canvas{border-radius:14px; border:1px solid var(--stroke); background:#111722}
  .gamewrap{display:grid; grid-template-columns:1fr 280px; gap:12px}
  .stat{padding:10px; border-radius:12px; border:1px solid var(--stroke); background:rgba(255,255,255,0.06)}
  .meter{height:8px; background:#ffffff1a; border-radius:999px; overflow:hidden; border:1px solid var(--stroke)}
  .meter .fill{display:block; height:100%; width:0%; background: linear-gradient(90deg, #59e48f, #7cc6ff)}
  .themes-wrap{display:grid; grid-template-columns: repeat(auto-fill, minmax(140px,1fr)); gap:10px}
  .swatch{
    padding:10px; border-radius:16px; border:1px solid var(--stroke); background:#ffffff12; cursor:pointer;
    position:relative; overflow:hidden; min-height:72px;
  }
  .swatch .tag{position:absolute; bottom:8px; left:8px; font-size:12px; color:#fff9; background:#0006; padding:4px 6px; border-radius:8px}
  .swatch:hover{outline:2px solid #fff4}
  .group-title{margin:14px 2px 8px; color:var(--muted); font-weight:600; text-transform:uppercase; letter-spacing:.08em; font-size:11px}
  .has-tt{position:relative}
  .has-tt:hover::after{
    content: attr(data-tt);
    position:absolute; top:-26px; left:0; white-space:nowrap; padding:4px 6px; border-radius:8px;
    background:#000a; border:1px solid var(--stroke); color:#fff; font-size:12px
  }
  .splash{
    position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, rgba(6,8,10,0.6), rgba(6,8,10,0.7));
    z-index:2000;
  }
  .splash-card{
    width:min(720px,94vw); border-radius:20px; padding:28px; text-align:center; background:var(--glass);
    border:1px solid var(--stroke); box-shadow:0 40px 120px #0009;
  }
  .splash h1{margin:4px 0 8px; font-size:36px; letter-spacing:1px}
  .splash p{color:var(--muted); margin:8px 0 18px}
  .splash .choices{display:flex; gap:12px; justify-content:center; flex-wrap:wrap}
  .muted{color:var(--muted)} .spacer{flex:1}
  @keyframes scrollCredits{0%{transform:translateY(100%)}100%{transform:translateY(-100%)}}
</style>
</head>
<body>
  <div class="shell" id="app">
    <div class="tabs" role="tablist" aria-label="Main sections">
      <div class="tab active" data-tab="aura" role="tab" aria-selected="true">ü´ß AuraAI</div>
      <div class="tab" data-tab="draw" role="tab">üé® Draw</div>
      <div class="tab" data-tab="bubble" role="tab">ü´ß Bubble Pop</div>
      <div class="clock" id="clock">--:--:--</div>
      <div class="spacer"></div>
      <button class="btn" id="musicBtn" title="Play / Pause">‚èØÔ∏è Music</button>
      <audio id="music" preload="auto">
        <source src="bgm.mp3" type="audio/mpeg">
        <source src="bgm2.mp3" type="audio/mpeg">
        <source src="bgm3.mp3" type="audio/mpeg">
      </audio>
    </div>

    <div class="panel active" id="panel-aura" role="tabpanel" aria-labelledby="aura-tab">
      <div class="bar">
        <div class="dock" id="emotionDock">
          <div class="chip" data-emote="happy">üòä Happy</div>
          <div class="chip" data-emote="sad">üò¢ Sad</div>
          <div class="chip" data-emote="angry">üò† Angry</div>
          <div class="chip" data-emote="nervous">üò∞ Nervous</div>
        </div>
        <div class="spacer"></div>
        <div class="chip has-tt" id="openThemes" data-tt="Themes">üé® Themes</div>
      </div>

      <div class="row">
        <div class="left">
          <div class="card">
            <div class="chat" id="chat"></div>
            <div class="bar">
              <input id="input" class="input" placeholder="Type here‚Ä¶ (hint: try celebration)"/>
              <button id="sendBtn" class="btn">Send</button>
            </div>
            <div class="quick">
              <div class="bubble" data-say="Let‚Äôs draw something!" data-action="openDraw">üé® Draw</div>
              <div class="bubble" data-say="I want to play a game!" data-action="openBubble">ü´ß Bubble Pop</div>
              <div class="bubble" data-say="Can we listen to music?">üéµ Music</div>
              <div class="bubble" data-say="Tell me something fun!">‚ú® Surprise</div>
            </div>
          </div>
        </div>
        <div class="right">
          <div class="card">
            <div class="bar"><div>Now Playing</div><div class="spacer"></div><div id="nowBar" class="muted">‚Äî</div></div>
            <div class="meter"><span id="meterFill" class="fill"></span></div>
            <div class="bar" style="margin-top:12px">
              <button class="btn" id="prev">‚èÆÔ∏è</button>
              <button class="btn" id="pp">‚èØÔ∏è</button>
              <button class="btn" id="next">‚è≠Ô∏è</button>
            </div>
          </div>
          <div class="card" id="themesPanel" style="display:none">
            <div class="group-title">Theme Sets</div>
            <div id="themesRoot" class="themes-wrap"></div>
            <div class="bar" style="margin-top:12px">
              <div class="spacer"></div>
              <button class="btn" id="backToAura">Done</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="panel" id="panel-draw" role="tabpanel" aria-labelledby="draw-tab">
      <div class="drawwrap">
        <div class="card">
          <canvas id="draw" width="900" height="520"></canvas>
        </div>
        <div class="card">
          <div class="tools">
            <div class="tool" data-tool="pen" aria-pressed="true">‚úèÔ∏è Pen</div>
            <div class="tool" data-tool="eraser">üßΩ Eraser</div>
            <div class="tool" data-tool="spray">üñåÔ∏è Spray</div>
            <div class="tool" data-tool="fill">ü™£ Fill</div>
            <div class="tool" data-tool="line">üìè Line</div>
          </div>
          <div class="bar" style="margin-top:10px">
            <input type="color" id="color" value="#7cc6ff" class="input" style="width:120px; padding:6px 8px"/>
            <input type="range" id="size" min="1" max="48" value="6" style="width:140px"/>
            <div class="spacer"></div>
            <button class="btn" id="undo">‚Ü©Ô∏è Undo</button>
            <button class="btn" id="redo">‚Ü™Ô∏è Redo</button>
            <button class="btn" id="clear">üóëÔ∏è Clear</button>
            <button class="btn" id="save">üíæ Save</button>
          </div>
        </div>
      </div>
    </div>

    <div class="panel" id="panel-bubble" role="tabpanel" aria-labelledby="bubble-tab">
      <div class="gamewrap">
        <div class="card">
          <canvas id="game" width="900" height="520"></canvas>
        </div>
        <div class="card">
          <div class="stat">Score: <span id="score">0</span></div>
          <div class="stat">Level: <span id="level">1</span></div>
          <div class="stat">Time: <span id="time">60</span>s</div>
          <div class="bar" style="margin-top:12px">
            <button class="btn" id="start">‚ñ∂Ô∏è Start</button>
            <button class="btn" id="stop">‚èπÔ∏è Stop</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="splash" id="splash" style="display:none">
    <div class="splash-card">
      <h1>AuraAI</h1>
      <p>Pick a quick start</p>
      <div class="choices">
        <button class="btn" data-go="aura">Chat</button>
        <button class="btn" data-go="draw">Draw</button>
        <button class="btn" data-go="bubble">Bubble Pop</button>
      </div>
    </div>
  </div>

<script>
const app = document.getElementById('app');
const tabs = document.querySelectorAll('.tab');
const panels = {
  aura: document.getElementById('panel-aura'),
  draw: document.getElementById('panel-draw'),
  bubble: document.getElementById('panel-bubble')
};
function showTab(name){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  panels[name].classList.add('active');
  document.querySelector(`.tab[data-tab="${name}"]`).classList.add('active');
}
tabs.forEach(t=>t.addEventListener('click', ()=>showTab(t.dataset.tab)));

const music = document.getElementById('music');
const musicBtn = document.getElementById('musicBtn');
let tracks = ["bgm.mp3","bgm2.mp3","bgm3.mp3"];
let currentTrack = 0;
function pickTrack(){ currentTrack = Math.floor(Math.random()*tracks.length); music.src = tracks[currentTrack]; }
pickTrack();
musicBtn.addEventListener('click', ()=>{
  if(music.paused){ music.play(); musicBtn.textContent='‚è∏Ô∏è Music'; }
  else{ music.pause(); musicBtn.textContent='‚èØÔ∏è Music'; }
});
music.addEventListener('ended', ()=>{ pickTrack(); music.play(); });

const THEME_GROUPS = {
  'Grayscale': [
    { name:'Pure White',bg:'#ffffff',grad:'#f0f0f0',text:'#000000'},
    { name:'White Smoke',bg:'#F5F5F5',grad:'#E8E8E8',text:'#3c3c3c'},
    { name:'Light Gray',bg:'#d3d3d3',grad:'#c0c0c0',text:'#3c3c3c'},
    { name:'Silver Mist',bg:'#b0b0b0',grad:'#a0a0a0',text:'#ffffff'},
    { name:'Steel Gray',bg:'#708090',grad:'#6c7a89',text:'#ffffff'},
    { name:'Slate',bg:'#405d72',grad:'#3c586b',text:'#ffffff'},
    { name:'Gunmetal',bg:'#2c3539',grad:'#364044',text:'#ffffff'},
    { name:'Charcoal',bg:'#36454f',grad:'#2c3539',text:'#ffffff'},
    { name:'Dark Slate',bg:'#2f4f4f',grad:'#243c3c',text:'#ffffff'},
    { name:'Jet Black',bg:'#000000',grad:'#1a1a1a',text:'#ffffff'},
    { name:'White',bg:'#ffffff',text:'#000000'},
    { name:'Gray',bg:'#808080',text:'#ffffff'},
    { name:'Black',bg:'#000000',text:'#ffffff'},
    { name:'Off White',bg:'#fafafa',text:'#3c3c3c'},
    { name:'Dim Gray',bg:'#696969',text:'#ffffff'},
    { name:'Dark Gray',bg:'#a9a9a9',text:'#ffffff'},
    { name:'Slate Gray',bg:'#708090',text:'#ffffff'},
    { name:'Light Slate Gray',bg:'#778899',text:'#ffffff'},
    { name:'Dark Slate Gray',bg:'#2f4f4f',text:'#ffffff'},
    { name:'Snow',bg:'#FFFAFA',text:'#3c3c3c'},
    { name:'Ivory',bg:'#FFFFF0',text:'#3c3c3c'},
    { name:'Gainsboro',bg:'#DCDCDC',text:'#3c3c3c'},
    { name:'Alice Blue',bg:'#F0F8FF',text:'#3c3c3c'},
    { name:'Ghost White',bg:'#F8F8FF',text:'#3c3c3c'},
    { name:'Platinum',bg:'#E5E4E2',text:'#3c3c3c'},
    { name:'Ash Gray',bg:'#B2BEB5',text:'#3c3c3c'},
    { name:'Nickel',bg:'#727472',text:'#ffffff'},
    { name:'Onyx',bg:'#353839',text:'#ffffff'}
  ],
  'Pastel': [
    { name:'Blush',bg:'#f8d7da',grad:'#f3cbd0',text:'#3c3c3c'},
    { name:'Sky',bg:'#cfe8ff',grad:'#b9dbff',text:'#3c3c3c'},
    { name:'Mint',bg:'#d1f7e2',grad:'#b6f0d0',text:'#3c3c3c'},
    { name:'Lavender',bg:'#e6e6fa',grad:'#d8d8f3',text:'#3c3c3c'},
    { name:'Peach',bg:'#ffe5d9',grad:'#ffd2c1',text:'#3c3c3c'},
    { name:'Butter',bg:'#fff4b8',grad:'#ffe98e',text:'#3c3c3c'},
    { name:'Seafoam',bg:'#dffaf0',grad:'#c5f3e4',text:'#3c3c3c'}
  ],
  'Metallic': [
    { name:'Gold',bg:'#d4af37',grad:'#f3cc52',text:'#3c3c3c'},
    { name:'Silver',bg:'#c0c0c0',grad:'#d6d6d6',text:'#3c3c3c'},
    { name:'Copper',bg:'#b87333',grad:'#c98a4a',text:'#ffffff'},
    { name:'Bronze',bg:'#cd7f32',grad:'#d89a55',text:'#ffffff'},
    { name:'Chrome',bg:'#8d929b',grad:'#a2a7af',text:'#3c3c3c'},
    { name:'Rose Gold',bg:'#b76e79',grad:'#c18f8f',text:'#ffffff'}
  ],
  'Animated': [
    { name:'Shifting Rainbow', animated:true, grad:'#ff6b6b, #ffc87c, #d5a3ff, #8aff8a', text:'#ffffff' },
    { name:'Ocean Waves', animated:true, grad:'#005bea, #00c6fb, #61d7f6, #005bea', text:'#ffffff' },
    { name:'Forest Glow', animated:true, grad:'#43ac62, #6a9d77, #8bb87d, #43ac62', text:'#ffffff' },
    { name:'Cosmic Dust', animated:true, grad:'#1c1c1c, #3f3f3f, #5b5b5b, #1c1c1c', text:'#ffffff' },
    { name:'Liquid Fire', animated:true, grad:'#ff416c, #ff4b2b, #ff8c00, #ff416c', text:'#ffffff' },
    { name:'Cyber Blue', animated:true, grad:'#00ffc8, #006aff, #8a2be2, #00ffc8', text:'#ffffff' },
    { name:'Synthwave', animated:true, grad:'#8e2de2, #4a00e0, #ff007f, #8e2de2', text:'#ffffff' },
    { name:'Volcano', animated:true, grad:'#d21f3c, #ff4500, #ffd700, #d21f3c', text:'#ffffff' }
  ],
  'Poster': [
    { name:'Crimson',bg:'#8d0426',text:'#ffffff'},
    { name:'Slate',bg:'#405d72',text:'#ffffff'},
    { name:'Carbon',bg:'#232526',text:'#ffffff'},
    { name:'Ruby',bg:'#d62828',text:'#ffffff'},
    { name:'Mahogany',bg:'#4c1e19',text:'#ffffff'},
    { name:'Olive',bg:'#556b2f',text:'#ffffff'},
    { name:'Charcoal',bg:'#36454f',text:'#ffffff'},
    { name:'Lemon',bg:'#fff733',text:'#3c3c3c'},
    { name:'Azure',bg:'#007fff',text:'#ffffff'},
    { name:'Maroon',bg:'#800000',text:'#ffffff'},
    { name:'Jade',bg:'#00a86b',text:'#ffffff'},
    { name:'Navy Blue',bg:'#000080',text:'#ffffff'},
    { name:'Slate Gray',bg:'#708090',text:'#ffffff'},
    { name:'Chocolate',bg:'#7b3f00',text:'#ffffff'},
    { name:'Dark Green',bg:'#006400',text:'#ffffff'},
    { name:'Midnight',bg:'#0a0a23',text:'#ffffff'},
    { name:'Teal Green',bg:'#008080',text:'#ffffff'},
    { name:'Eggplant',bg:'#614051',text:'#ffffff'},
    { name:'Burnt Orange',bg:'#cc5500',text:'#ffffff'}
  ]
};
const themesRoot = document.getElementById('themesRoot');
function renderThemes(){
  themesRoot.innerHTML='';
  for(const [group, items] of Object.entries(THEME_GROUPS)){
    const title = document.createElement('div'); title.className='group-title'; title.textContent=group; themesRoot.appendChild(title);
    const grid = document.createElement('div'); grid.className='themes-wrap'; themesRoot.appendChild(grid);
    items.forEach(theme=>{
      const tile = document.createElement('div'); tile.className='swatch has-tt'; tile.dataset.tt = theme.name;
      if(theme.animated){
        tile.style.background = `linear-gradient(120deg, ${theme.grad})`;
        tile.style.backgroundSize = '300% 300%';
        tile.animate([{backgroundPosition:'0% 50%'},{backgroundPosition:'100% 50%'},{backgroundPosition:'0% 50%'}],{duration:9000,iterations:Infinity});
      }else if(theme.grad){
        tile.style.background = `linear-gradient(120deg, ${theme.bg}, ${theme.grad})`;
      }else{
        tile.style.background = theme.bg;
      }
      const tag = document.createElement('div'); tag.className='tag'; tag.textContent = theme.name; tile.appendChild(tag);
      tile.addEventListener('click', ()=>applyTheme(theme));
      grid.appendChild(tile);
    });
  }
}
function applyTheme(t){
  document.documentElement.style.setProperty('--bg', t.bg || '#0e1116');
  document.documentElement.style.setProperty('--text', t.text || '#eef2f6');
  document.documentElement.style.setProperty('--accent', '#7cc6ff');
  document.documentElement.style.setProperty('--accent-2', '#a8a6ff');
  const body = document.body;
  if(t.animated){
    const grad = `linear-gradient(120deg, ${t.grad})`;
    body.style.background = grad;
    body.style.backgroundSize = '300% 300%';
    body.animate([{backgroundPosition:'0% 50%'},{backgroundPosition:'100% 50%'},{backgroundPosition:'0% 50%'}],{duration:9000,iterations:Infinity});
    const targets = document.querySelectorAll('.shell, .tab.active, .btn');
    targets.forEach(el=>{
      el.style.background = grad;
      el.style.backgroundSize = '300% 300%';
      el.animate([{backgroundPosition:'0% 50%'},{backgroundPosition:'100% 50%'},{backgroundPosition:'0% 50%'}],{duration:9000,iterations:Infinity});
    });
  } else if(t.grad){
    body.style.background = `linear-gradient(180deg, ${t.bg}, ${t.grad})`;
  }else{
    body.style.background = t.bg;
  }
}
const openThemes = document.getElementById('openThemes');
const backToAura = document.getElementById('backToAura');
openThemes.addEventListener('click',()=>{ document.getElementById('themesPanel').style.display='block'; });
backToAura.addEventListener('click',()=>{ document.getElementById('themesPanel').style.display='none'; });
renderThemes();

const chat = document.getElementById('chat');
const input = document.getElementById('input');
const sendBtn = document.getElementById('sendBtn');
function auraSay(txt){ const el = document.createElement('div'); el.className='msg'; el.innerHTML = txt; chat.appendChild(el); chat.scrollTop = chat.scrollHeight; }
function meSay(txt){ const el = document.createElement('div'); el.className='msg me'; el.textContent = txt; chat.appendChild(el); chat.scrollTop = chat.scrollHeight; }

function respond(msg){
  const clean = msg.toLowerCase();
  if(clean.includes("celebration")){ startCelebration(); return; }
  if(/(happy|great|good|yay)/.test(clean)) auraSay("That‚Äôs awesome! üéâ Want to pick an activity or keep chatting?");
  else if(/(sad|down|blue|cry|upset)/.test(clean)) auraSay("I‚Äôm here. üíô Want a comfort idea or an activity together?");
  else if(/(angry|mad|frustrated|annoyed)/.test(clean)) auraSay("I hear you. Let‚Äôs channel that in a healthy way. Want to pop bubbles to vent or try a calming breath?");
  else if(/(nervous|anxious|worry|scared)/.test(clean)) auraSay("Thanks for sharing. Try a 4‚Äë4‚Äë6 breath with me, or we can draw gently.");
  else if(/(draw|sketch|paint)/.test(clean)){ auraSay("Opening Draw for you. ‚ú®"); showTab('draw'); }
  else if(/(bubble|game|play)/.test(clean)){ auraSay("Let‚Äôs play Bubble Pop! ü´ß"); showTab('bubble'); }
  else if(/(hug)/.test(clean)){ auraSay("Sending a big gentle hug ü§ó You‚Äôre cared for."); }
  else auraSay("Got it. Tell me more, or choose an activity: Draw ‚Ä¢ Bubble Pop ‚Ä¢ Music.");
}
sendBtn.addEventListener('click', ()=>{
  const v = input.value.trim(); if(!v) return;
  meSay(v); respond(v); input.value='';
});
input.addEventListener('keydown', e=>{ if(e.key==='Enter') sendBtn.click(); });

const emotionDock = document.getElementById('emotionDock');
const emotionPrompts = {
  happy:[
    "Your energy is infectious! Want to try the game or a quick doodle?",
    "We could create a fun sticker sheet in Draw!"
  ],
  sad:[
    "It‚Äôs okay to feel this way. I‚Äôm here with you.",
    "Small steps help. A calm color theme might feel nice."
  ],
  angry:[
    "Strong feelings are valid. Let‚Äôs move them safely.",
    "Popping bubbles is surprisingly satisfying."
  ],
  nervous:[
    "You‚Äôre not alone. Deep breaths together.",
    "We can sketch something soothing."
  ]
};
emotionDock.querySelectorAll('.chip').forEach(ch=>{
  ch.addEventListener('click', ()=>{
    emotionDock.querySelectorAll('.chip').forEach(x=>x.setAttribute('aria-pressed','false'));
    ch.setAttribute('aria-pressed','true');
    const em = ch.dataset.emote;
    emotionPrompts[em].forEach(auraSay);
  });
});
document.querySelectorAll('.bubble').forEach(b=>{
  const say = b.dataset.say; const act = b.dataset.action;
  b.addEventListener('click', ()=>{
    if(say){ meSay(say); respond(say); }
    if(act==='openDraw'){ showTab('draw'); }
    if(act==='openBubble'){ showTab('bubble'); }
  });
});

const nowBar = document.getElementById('nowBar');
const meter = document.getElementById('meterFill');
let prog=0; setInterval(()=>{ prog = (prog+2)%100; meter.style.width = prog+'%'; }, 150);

const draw = document.getElementById('draw');
const dctx = draw.getContext('2d');
let drawing=false, tool='pen', color=document.getElementById('color').value, size=+document.getElementById('size').value;
let hist=[], redoS=[];
function snap(){ hist.push(draw.toDataURL()); if(hist.length>50) hist.shift(); redoS.length=0; }
function point(e){ const r=draw.getBoundingClientRect(); return {x:(e.clientX||e.touches?.[0].clientX)-r.left, y:(e.clientY||e.touches?.[0].clientY)-r.top}; }
function lineTo(p){ dctx.lineTo(p.x,p.y); dctx.stroke(); }
draw.addEventListener('mousedown', e=>{ drawing=true; dctx.beginPath(); const p=point(e); dctx.moveTo(p.x,p.y); dctx.lineWidth=size; dctx.strokeStyle=color; dctx.lineCap='round'; snap(); });
draw.addEventListener('mousemove', e=>{ if(!drawing) return; if(tool==='pen'){ lineTo(point(e)); }});
window.addEventListener('mouseup', ()=>drawing=false);
document.getElementById('color').addEventListener('input', e=>{ color=e.target.value; });
document.getElementById('size').addEventListener('input', e=>{ size=+e.target.value; });
document.querySelectorAll('.tool').forEach(t=>{
  t.addEventListener('click', ()=>{
    document.querySelectorAll('.tool').forEach(x=>x.setAttribute('aria-pressed','false'));
    t.setAttribute('aria-pressed','true');
    tool = t.dataset.tool;
  });
});
document.getElementById('undo').addEventListener('click', ()=>{
  if(!hist.length) return; const last = hist.pop(); redoS.push(draw.toDataURL());
  const img = new Image(); img.onload=()=>{ dctx.clearRect(0,0,draw.width,draw.height); dctx.drawImage(img,0,0); }; img.src = hist[hist.length-1]||last;
});
document.getElementById('redo').addEventListener('click', ()=>{
  if(!redoS.length) return; const img = new Image(); const url = redoS.pop(); hist.push(url); img.onload=()=>{ dctx.clearRect(0,0,draw.width,draw.height); dctx.drawImage(img,0,0); }; img.src=url;
});
document.getElementById('clear').addEventListener('click', ()=>{ dctx.clearRect(0,0,draw.width,draw.height); snap(); });
document.getElementById('save').addEventListener('click', ()=>{
  const a = document.createElement('a'); a.download='aura-drawing.png'; a.href=draw.toDataURL('image/png'); a.click();
});

const game = document.getElementById('game'); const g = game.getContext('2d');
let bubbles=[], score=0, level=1, secs=60, timer=null, spawning=false;
function newBubble(){ return {x:Math.random()*game.width, y:game.height+40, r: 14+Math.random()*22, v:1+Math.random()*level*0.5, h: Math.random()*360 }; }
function spawn(){ if(!spawning) return; bubbles.push(newBubble()); setTimeout(spawn, 600 - Math.min(500, level*40)); }
function drawGame(){
  g.clearRect(0,0,game.width,game.height);
  for(const b of bubbles){
    g.beginPath(); const grad = g.createRadialGradient(b.x-b.r*0.3,b.y-b.r*0.3, b.r*0.2, b.x,b.y,b.r);
    grad.addColorStop(0, `hsla(${b.h},90%,70%,0.9)`); grad.addColorStop(1, `hsla(${b.h},90%,50%,0.35)`);
    g.fillStyle=grad; g.arc(b.x,b.y,b.r,0,Math.PI*2); g.fill();
    b.y -= b.v;
  }
  requestAnimationFrame(drawGame);
}
game.addEventListener('click', e=>{
  const r=game.getBoundingClientRect(); const x=e.clientX-r.left, y=e.clientY-r.top;
  for(let i=bubbles.length-1;i>=0;i--){ const b=bubbles[i]; const dx=x-b.x, dy=y-b.y; if(dx*dx+dy*dy<=b.r*b.r){ bubbles.splice(i,1); score++; document.getElementById('score').textContent=score; break; } }
});
document.getElementById('start').addEventListener('click', ()=>{
  if(timer) return;
  spawning=true; spawn();
  timer = setInterval(()=>{ secs--; document.getElementById('time').textContent=secs; if(secs%10===0){ level++; document.getElementById('level').textContent=level; } if(secs<=0){ clearInterval(timer); timer=null; spawning=false; } }, 1000);
});
document.getElementById('stop').addEventListener('click', ()=>{
  spawning=false; clearInterval(timer); timer=null;
});
(function initGameCanvas(){ drawGame(); })();

function startConfetti(){
  if(document.getElementById('confettiCanvas')) return;
  const c = document.createElement('canvas'); c.id='confettiCanvas'; c.style.cssText='position:fixed;inset:0;pointer-events:none;z-index:2500'; document.body.appendChild(c);
  const ctx = c.getContext('2d'); let w= c.width= innerWidth, h= c.height= innerHeight; const parts = Array.from({length:160},()=>({x:Math.random()*w,y:Math.random()*-h,vx:(Math.random()-0.5)*1.2,vy:Math.random()*3+2,s:Math.random()*6+4,c:`hsl(${Math.random()*360},90%,60%)`,a:Math.random()*Math.PI}));
  addEventListener('resize',()=>{w=c.width=innerWidth;h=c.height=innerHeight});
  let raf; (function loop(){ ctx.clearRect(0,0,w,h); for(const p of parts){ p.x+=p.vx; p.y+=p.vy; p.a+=0.1; if(p.y>h){p.y=-10;p.x=Math.random()*w} ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.a); ctx.fillStyle=p.c; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s); ctx.restore(); } raf=requestAnimationFrame(loop) })(); c.dataset.raf = '1';
}
function stopConfetti(){ const c=document.getElementById('confettiCanvas'); if(c){ cancelAnimationFrame(+c.dataset.raf||0); c.remove(); }}
function startCelebration(){
  startConfetti();
  setTimeout(()=>{
    const bgMusic = new Audio("https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"); bgMusic.volume=0.5; bgMusic.play();
    const overlay = document.createElement("div");
    overlay.id="credits"; overlay.style.cssText="position:fixed;inset:0;background:black;color:white;display:flex;justify-content:flex-end;align-items:center;font-family:Helvetica Neue,Arial,sans-serif;text-align:center;font-size:2em;overflow:hidden;z-index:3000;opacity:0;transition:opacity 1.2s";
    const inner = document.createElement("div"); inner.id="creditsContent"; inner.style.cssText="display:flex;flex-direction:column;gap:40px;animation:scrollCredits 25s linear forwards";
    inner.innerHTML = '<div>AuraAI üí´</div><div>Created by: Keshav & Kritika + Aadhya</div><div>Special thanks to all parents and Ms Anjali for the support</div><div>Coolest Projects Malaysia 2025 ‚ú®</div><div style="margin-top:200px;font-size:.7em;opacity:.8">Press any key to return</div>';
    overlay.appendChild(inner); document.body.appendChild(overlay); requestAnimationFrame(()=>{overlay.style.opacity=1});
    if(typeof stopConfetti==="function"){ setTimeout(stopConfetti,2000); }
    const exit=()=>{ overlay.remove(); removeEventListener("keydown",exit) }; addEventListener("keydown",exit,{once:true});
  },10000);
}
const __clk=document.getElementById("clock");function updateClock(){if(!__clk)return;const n=new Date();__clk.textContent=n.toLocaleTimeString();}setInterval(updateClock,1000);updateClock();
</script>
</body>
</html>
